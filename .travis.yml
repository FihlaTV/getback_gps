#based on https://raw.github.com/leviwilson/android-travis-ci-example/master/.travis.yml
language: android
env:
  global:
    secure: "mMIHz+I2pZK7I9PvhkTIRDeXJJIZTwigAamHnaId1q9YO7LvBoCKsJCI7pepbK303lTZJqkTgyTti9xSsYjzMIIMT8G+YBfVqoiy6wWOZjwjjZxn5Mw7g3qxRRdpXCc7B7hBBTEiEzC0Bp3QwPQtwdFDlACwgHWsbDLiaweIglg="
before_install:
  - cd $HOME
  # install and initialise build-trend scripts
  - git clone https://github.com/ruleant/buildtime-trend.git
  - source buildtime-trend/init.sh
  - mvn -v
  - timestamp.sh install_libs
  - sudo apt-get update -qq
  - sudo apt-get install -qq python-pip
  # install buildtime-trend dependencies using pip
  - timestamp.sh install_python_libs
  - sudo CFLAGS="-O0" pip install -r ${BUILD_TREND_HOME}/requirements.txt
  # deploy android SDK jar to local maven repository
  - timestamp.sh deploy_android_sdk
  - $TRAVIS_BUILD_DIR/.utility/deploy-sdk-to-m2-repo.sh
  # return to directory where the repository being built has been copied on the worker.
  - cd $TRAVIS_BUILD_DIR
  - timestamp.sh build
script:
  - timestamp.sh test
  - mvn test -B
after_success:
  # send code coverage results to coveralls.io
  - timestamp.sh coverage
  - mvn clean test cobertura:cobertura coveralls:cobertura -B
  # update javadoc on Github Pages (gh-pages)
  - timestamp.sh update_javadoc
  - mvn clean install javadoc:javadoc -DskipTests=true
  - .utility/copy-javadoc-to-gh-pages.sh
after_script:
  # analyse build timestamps
  - timestamp.sh end
  - sync-buildtime-trend-with-gh-pages.sh
